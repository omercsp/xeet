include: [xeet_base.yaml, inheritance.yaml]
tests:
  - name: 001_pass
    short_desc: returns true, always passes
    run:
      - base: "settings.common_steps._true"
    groups: [passing]

  - name: 002_pass_with_output
    short_desc: echoes Hello World!\\n
    run:
      - base: "settings.common_steps.hello"
        expected_stdout: "Hello World!\n"
    groups: [passing]

  - name: 003_fail_over_output
    short_desc: echoes Hello World!
    run:
      - base: "settings.common_steps.hello"
        expected_stdout: "Goodbye World!\n"
    groups: [failing]

  - name: 004_fail_over_rc
    short_desc: echoes Hello World!
    run:
      - base: "settings.common_steps._true"
        allowed_rc: [1]
    groups: [failing]

  - name: 005_fail_2nd_step
    short_desc: runs two steps, fail over the second
    run:
      - base: "settings.common_steps._true"
      - base: "settings.common_steps._false"
    groups: [failing]

  - name: 006_skip
    short_desc: expected to be skipped
    run:
      - base: "settings.common_steps._true"
    groups: [skipped]
    skip: true

  - name: 007_skip_reason
    short_desc: expected to be skipped, issue a skip reason
    run:
      - base: "settings.common_steps._true"
    groups: [skipped]
    skip: true
    skip_reason: This test is expected to be skipped

  - name: 008_bad_desc
    short_desc: bad test descriptor
    bad_setting: bad_value
    groups: [not_run]

  - name: 009_expected_fail
    run:
      - base: "settings.common_steps._true"
      - base: "settings.common_steps._false" #  will fail here
      - base: "settings.common_steps._true" #  will not run
    expected_failure: true
    groups: [expected_failure]

  - name: 010_unexpected_pass
    run:
      - base: "settings.common_steps._true"
    expected_failure: true
    groups: [failing]

  - name: 011_bad_cmd
    run:
      - cmd: "bad_command"
    groups: [not_run]

  - name: 012_inherit_and_fix_bad_cmd
    base: 011_bad_cmd
    short_desc: inherits a bad command test, but replaces it with a good one
    run:
      - cmd: "{true_cmd}"
    groups: [passing]

  - name: 009_env_pass
    short_desc: prints environment variable
    run:
      - cmd: "{showenv_cmd} TEST_ENV_VAR"
        env:
          TEST_ENV_VAR: test value
        expected_stdout: "test value\n"
    groups: [passing]

  - name: 010_timeout_fail
    short_desc: timeout test
    run:
      - cmd: "{sleep_cmd} 1"
        timeout: 0.5
    groups: [not_run]

  - name: 013_multi_rc_passing
    short_desc: Random RC, shoudld pass
    run:
      - cmd: '{rand_rc_cmd}'
        allowed_rc: "*"
    groups: [passing]

  - name: 014_show_auto_vars_internal
    short_desc: Test auto variables
    run:
      - cmd: "{echo_cmd} Xeet root: {XG_ROOT}"
        expected_stdout: "Xeet root: {XG_ROOT}\n"
      - cmd: "{echo_cmd} Test name: {XT_NAME}"
        expected_stdout: "Test name: 014_show_auto_vars_internal\n"
      - cmd: "{echo_cmd} Test output dir: {XT_OUT_DIR}"
        expected_stdout: "Test output dir: {XG_OUT_DIR}/{XT_NAME}\n"
      # - type: exec
      #   cmd: "{echo_cmd} Test stdout: {XT_STDOUT}"
      #   expected_stdout: "Test stdout:\n"
    groups: [passing]

  - name: 015_pre_test_ok
    short_desc: Test with passing pre-run command
    pre_run:
      - cmd: "{true_cmd}"
    run:
      - cmd: "{echo_cmd} hey!"
        expected_stdout: "hey!\n"
    groups: [passing]

  - name: 016_not_run_pre_test_fail
    short_desc: Test with passing pre-run command
    pre_run:
      - cmd: "{true_cmd}"
      - type: exec
        cmd: "{false_cmd}"
    run:
      - cmd: "{echo_cmd} hey!"
        expected_stdout: "hey!\n"
    groups: [not_run]

  - name: 017_post_test_ok
    short_desc: Test with valid post-test command
    run:
      - cmd: "{true_cmd}"
    post_run:
      - cmd: "{true_cmd}"
    groups: [passing]

  - name: 018_post_test_fail
    # Should pass, but post-test fails and should issue a warning
    short_desc: Test with invalid post-test command
    run:
      - cmd: "{true_cmd}"
    post_run:
      - cmd: "{false_cmd}"
    groups: [passing, bad_post]

  - name: 019_fix_post_fail
    base: 018_post_test_fail
    post_run:
      - cmd: "{true_cmd}"
    groups: [passing]

  - name: 020_inherit_abstract_pre_run_good
    base: abstract_pre_run_good
    groups: [passing, inheritance]
    run:
      - cmd: "{true_cmd}"

  - name: 021_inherit_abstract_pre_run_bad
    base: abstract_pre_run_bad
    groups: [not_run, inheritance]
    run:
      - cmd: "{true_cmd}"

  - name: 022_inherit_abstract_pre_run_bad_add_pre_run
    base: abstract_pre_run_bad
    groups: [not_run, inheritance]
    # 2nd step of the pre-run should fail, and test is set to not_run
    pre_run_inheritance: prepend
    pre_run:
      - cmd: "{true_cmd}"
    run:
      - cmd: "{true_cmd}"

  - name: 023_inherit_abstract_run_good
    base: abstract_run_good
    groups: [passing, inheritance]

  - name: 024_inherit_abstract_run_good_add_run
    base: abstract_run_good
    run_inheritance: append
    run:
      - cmd: "{echo_cmd} hey!"
    groups: [passing, inheritance]

  - name: 025_inherit_abstract_run_bad
    base: abstract_run_bad
    groups: [failing, inheritance]

  - name: 026_inherit_abstract_run_bad_add_run
    base: abstract_run_bad
    run_inheritance: append
    run:
      - cmd: "{echo_cmd} hey!"
    groups: [failing, inheritance]

  - name: 027_inherit_abstract_post_run_good
    base: abstract_post_run_good
    run:
      - cmd: "{true_cmd}"
    groups: [passing, inheritance]

  - name: 028_inherit_abstract_post_run_bad
    base: abstract_post_run_bad
    run:
      - cmd: "{true_cmd}"
    groups: [passing, inheritance, bad_post]

  - name: 030_for_info
    short_desc: prints current directory
    run:
      - cmd: "{pwd_cmd}"
        expected_stdout: "{XG_CWD}\n"
      - cmd:
        env:
          TEST_ENV_VAR: test value
        cmd: "{showenv_cmd} TEST_ENV_VAR"
        expected_stdout: "test value\n"
    post_run:
      - cmd: "{echo_cmd} Test output dir: {XT_OUT_DIR}"
        expected_stdout: "Test output dir: {XG_OUT_DIR}/{XT_NAME}\n"
    groups: [passing]
