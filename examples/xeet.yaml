variables:
  scripts_dir: '{XEET_ROOT}/../scripts/testing'
  echo: 'python {scripts_dir}/echo.py'
  false_cmd: 'python {scripts_dir}/rc.py 1'
  sleep_cmd: 'python {scripts_dir}/sleep.py'
  rand_rc_cmd: 'python {scripts_dir}/rc.py'
  echo_cmd: 'python {scripts_dir}/echo.py'
settings:
  common_steps:
    "_true":
      type: exec
      cmd: 'python {scripts_dir}/rc.py 0'
    "_false":
      type: exec
      cmd: 'python {scripts_dir}/rc.py 1'
    "hello":
      type: exec
      cmd: '{echo} Hello World!'
tests:
  - name: 001_pass
    short_desc: echoes Hello World!
    run:
      - base: "settings.common_steps._true"
    groups: [passing]

  - name: 002_pass_with_output
    short_desc: echoes Hello World!
    run:
      - base: "settings.common_steps.hello"
        expected_stdout: "Hello World!\n"
    groups: [passing]

  - name: 003_fail_over_output
    short_desc: echoes Hello World!
    run:
      - base: "settings.common_steps.hello"
        expected_stdout: "Goodbye World!\n"
    groups: [failing]

  - name: 004_fail_over_rc
    short_desc: echoes Hello World!
    run:
      - base: "settings.common_steps._true"
        allowed_rc: [1]
    groups: [failing]

  - name: 005_fail_2nd_step
    short_desc: runs two steps, fail over the second
    run:
      - base: "settings.common_steps._true"
      - base: "settings.common_steps._false"
    groups: [failing]

  - name: 006_skip
    short_desc: expected to be skipped
    run:
      - base: "settings.common_steps._true"
    groups: [skipped]
    skip: true

  - name: 007_skip_reason
    short_desc: expected to be skipped
    run:
      - base: "settings.common_steps._true"
    groups: [skipped]
    skip: true
    skip_reason: This test is expected to be skipped

  - name: 008_bad_desc
    short_desc: bad test descriptor
    bad_setting: bad_value
    groups: [not_run]

  - name: 009_expected_fail
    run:
      - base: "settings.common_steps._true"
      - base: "settings.common_steps._false" #  will fail here
      - base: "settings.common_steps._true" #  will not run
    expected_failure: true
    groups: [expected_failure]

  - name: 010_unexpected_pass
    run:
      - base: "settings.common_steps._true"
    expected_failure: true
    groups: [failing]

  - name: 011_bad_cmd
    run:
      - type: exec
        cmd: "bad_command"
    groups: [not_run]

  - name: 012_inherit_and_fix_bad_cmd
    base: 011_bad_cmd
    short_desc: inherits a bad command test, but replaces it with a good one
    run:
      - type: exec
        cmd: "true"
    groups: [passing]

  - name: 009_env_pass
    short_desc: prints environment variable
    run:
      - type: exec
        cmd: "printenv TEST_ENV_VAR"
        env:
          TEST_ENV_VAR: test value
        expected_stdout: "test value\n"
    groups: [passing]

  - name: 010_timeout_fail
    short_desc: timeout test
    run:
      - type: exec
        cmd: "{sleep_cmd} 1"
        timeout: 0.5
    groups: [not_run]

  - name: 013_multi_rc_passing
    short_desc: Random RC, shoudld pass
    run:
      - type: exec
        cmd: '{rand_rc_cmd}'
        allowed_rc: "*"
    groups: [passing]

  - name: 014_show_auto_vars_internal
    short_desc: Test auto variables
    run:
      - type: exec
        cmd: "{echo_cmd} Test name: {XEET_TEST_NAME}"
        expected_stdout: "Test name: 014_show_auto_vars_internal\n"
      # - type: exec
      #   cmd: "{echo_cmd} Test output dir: {XEET_TEST_OUTPUT_DIR}"
      #   expected_stdout: "Test output dir: {XEET_TEST_OUTPUT_DIR}\n"
      - type: exec
        cmd: "{echo_cmd} Test stdout: {XEET_TEST_STDOUT}"
        expected_stdout: "Test stdout: {XEET_TEST_STDOUT}\n"
      - type: exec
        cmd: "{echo_cmd} Test stderr: {XEET_TEST_STDERR}"
        expected_stdout: "Test stderr: {XEET_TEST_STDERR}\n"
      - type: exec
        cmd: "{echo_cmd} Xeet root: {XEET_ROOT}"
        expected_stdout: "Xeet root: {XEET_ROOT}\n"
    groups: [passing]

  # - name: 015a_pre_test_ok
  #   short_desc: Test with passing pre-run command
  #   pre_cmd: "true"
  #   cmd: echo {XEET_TEST_NAME}
  #   groups: [passing]

  # - name: 015b_pre_test_fail
  #   short_desc: Test with failing pre-run command
  #   base: 015a_pre_test_ok
  #   pre_cmd: "false"
  #   groups: [not_run]

  # - name: 015c_verification_fail
  #   short_desc: Test failing over verification
  #   base: 015a_pre_test_ok
  #   verify_cmd: "false"
  #   groups: [failing]

  # - name: 015d_test_verification_ok
  #   short_desc: Post command verification check
  #   variables:
  #     output_file: '{XEET_TEST_OUTPUT_DIR}/{XEET_TEST_NAME}.txt'
  #     verification_file: '{XEET_ROOT}/auxiliary/{XEET_TEST_NAME}.txt'
  #   cmd: echo 'Silence is golden' > {output_file}
  #   shell: true
  #   verify_cmd: diff -u {output_file} {verification_file}
  #   groups: [passing]

  # - name: 015e_bad_pre_test_cmd
  #   short_desc: Test with invalid pre-run command
  #   base: 015a_pre_test_ok
  #   pre_cmd: does_not_exist
  #   groups: [not_run]

  # - name: 020_post_test_ok
  #   short_desc: Test with valid post-test command
  #   base: 015a_pre_test_ok
  #   post_cmd: "true"
  #   groups: [passing]

  # - name: 021_post_test_fail
  #   short_desc: Test with invalid post-test command
  #   base: 015a_pre_test_ok
  #   post_cmd: "false"
  #   groups: [passing]

  # - name: 022_post_test_fail_output
  #   short_desc: Test with invalid post-test command and output
  #   base: 015a_pre_test_ok
  #   post_cmd_shell: true
  #   post_cmd: echo failing post test output; false
  #   groups: [passing]
